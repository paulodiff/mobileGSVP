"use strict";angular.module("myApp",["ionic","ui.router","ngResource","restangular","ui.bootstrap","myApp.filters","myApp.services","myApp.directives","myApp.controllers"]).config(["$stateProvider","$urlRouterProvider","RestangularProvider",function(t,e,o){e.otherwise("/menu/home"),t.state("menu",{url:"/menu","abstract":!0,templateUrl:"menu.html"}),t.state("menu.home",{url:"/home",views:{menuContent:{templateUrl:"partials/loginM.html",controller:"LoginController"}},accessLevel:"free1"}),t.state("menu.login",{url:"/login",views:{menuContent:{templateUrl:"partials/loginM.html",controller:"LoginController"}},accessLogged:!1}),t.state("menu.report",{url:"/report",views:{menuContent:{templateUrl:"partials/reportM.html",controller:"ReportCtrlMobile"}},accessLogged:!0,configAction:"new"}),t.state("menu.list",{url:"/list",views:{menuContent:{templateUrl:"partials/ListItemM.html",controller:"InfiniteCtrl"}},accessLogged:!0,configAction:"new"}),t.state("menu.new",{url:"/new",views:{menuContent:{templateUrl:"partials/EditItemM.html",controller:"EditItemCtrl"}},accessLogged:!0,configAction:"new"}),t.state("menu.edit",{url:"/edit/:id",views:{menuContent:{templateUrl:"partials/EditItemM.html",controller:"EditItemCtrl"}},accessLogged:!0,configAction:"edit"}),t.state("view",{url:"/view/:id",templateUrl:"partials/EditItemM.html",controller:"EditItemCtrl",accessLogged:!0,configAction:"view"}),t.state("menu.listRelazioni",{url:"/listRelazioni",views:{menuContent:{templateUrl:"partials/ListItemRelazioniM.html",controller:"InfiniteCtrlRelazioni"}},accessLogged:!0,configAction:"new"}),t.state("menu.newRelazioni",{url:"/newRelazioni/:id",views:{menuContent:{templateUrl:"partials/EditItemRelazioniM.html",controller:"EditItemCtrlRelazioni"}},accessLogged:!0,configAction:"new"}),t.state("menu.editRelazioni",{url:"/editRelazioni/:id",views:{menuContent:{templateUrl:"partials/EditItemRelazioniM.html",controller:"EditItemCtrlRelazioni"}},accessLogged:!0,configAction:"edit"}),t.state("menu.about",{url:"/about",views:{menuContent:{templateUrl:"partials/aboutM.html",controller:"AboutController"}},accessLogged:!1,configAction:"view"}),t.state("menu.help",{url:"/help",views:{menuContent:{templateUrl:"partials/helpM.html",controller:"HelpController"}},accessLogged:!1,configAction:"view"}),t.state("test",{url:"/test",templateUrl:"partials/testM.html",controller:"TestController",accessLogged:!1,configAction:"view"}),o.setBaseUrl("/apiQ"),o.setDefaultRequestParams({apiKey:"**********************"}),o.setRestangularFields({id:"_id.$oid"}),o.setRequestInterceptor(function(t,e){return"put"===e?(t._id=void 0,t):t})}]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("API_PROVIDER_URL",{base_url:"http://10.0.1.157:3000",url2:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",editor:"editor",guest:"guest"});
"use strict";angular.module("myApp.controllers",[]).controller("AppCtrl",["$scope","USER_ROLES","AUTH_EVENTS","$rootScope","AuthService","modalService","Session","Restangular","$state",function(e,t,i,n,o,r,a,s,l){e.currentUser=null,e.userRoles=t,e.isAuthorized=o.isAuthorized,e.go=function(e){l.go(e)},n.$on(i.loginSuccess,function(){e.currentUser=a.nome_breve_utenti,s.setDefaultRequestParams({apiKey:a.token})}),n.$on(i.loginFailed,function(){r.showModal({},{type:2,closeButtonText:"Cancel",actionButtonText:"Ok",headerText:"Login errato",bodyText:"Immettere nome utente e password corrette"}).then(function(){})}),n.$on(i.notAuthenticated,function(){e.currentUser=a.nome_breve_utenti,r.showModal({},{type:2,closeButtonText:"Cancel",actionButtonText:"Ok",headerText:"Utente non autenticato",bodyText:"Immettere nome utente e password dalla pagina home"}).then(function(){})}),n.$on("$stateChangeStart",function(e,t){t.accessLogged&&(o.isAuthenticated()||(e.preventDefault(),n.$broadcast(i.notAuthenticated)))})}]).controller("EditItemCtrl",["$scope","$state","$stateParams","Restangular","modalService","rService","Session",function(e,t,i,n,o,r,a){var s=t.current.configAction;if(e.configAction=s,e.item={},e.openedPopupDate=!1,"edit"==s||"view"==s){var l=n.all("serviziAll");l.getList({limit:50,id_servizi_selezione:i.id}).then(function(t){e.item=t[0],e.item.a_ora_servizi=new Date(t[0].a_ora_servizi),e.item.da_ora_servizi=new Date(t[0].da_ora_servizi),e.timeCalculated=r.time_diff(e.item.da_ora_servizi,e.item.a_ora_servizi)})}if("new"==s){var u={id_utenti:1,id_volontari_servizi:0,data_servizi:new Date,da_ora_servizi:new Date("1900-01-01T08:30:00.000Z"),a_ora_servizi:new Date("1900-01-01T10:30:00.000Z"),note_servizi:"",rapporto_servizi:""};e.item=u,e.timeCalculated=r.time_diff(new Date("1900-01-01T08:15:00.000Z"),new Date("1900-01-01T19:33:00.000Z"))}if(a.isAdmin){var c=n.all("utentiAll");c.getList().then(function(t){e.utentiList=t})}else e.utentiList=[],e.utentiList.push({id_utenti:a.id_utenti,nome_breve_utenti:a.nome_breve_utenti}),e.item.id_utenti=a.id_utenti;var _=n.all("volontariAll");_.getList().then(function(t){e.volontariList=t}),e.master={},e.timeCalculated=0,e.timechanged=function(){e.timeCalculated=r.time_diff(e.item.da_ora_servizi,e.item.a_ora_servizi)},e.cancel_action=function(e){o.showModal({},{type:1,closeButtonText:"Indietro",actionButtonText:"Ok - Elimina!",headerText:"Messaggio",bodyText:"Eliminare il presente servizio?"}).then(function(){n.oneUrl("servizi","/api1/servizi/"+e.id_servizi).get().then(function(i){i.annullato_servizi=1,n.setBaseUrl("/api1"),i.customPUT({annullato_servizi:1},e.id_servizi,{},{}),n.setBaseUrl("/apiQ"),t.go("list")})})},e.save_action=function(){var i="";if(e.item.a_ora_servizi<=e.item.da_ora_servizi&&(i="Orario servizi errato!"),0==e.item.id_volontari_servizi&&(i="Selezionare un volontario!"),e.item.data_servizi<new Date&&(i="Non è possibile selezionare date del servizio precedenti a quelle odierna."),""!=i)o.showModal({},{type:2,closeButtonText:"Cancel",actionButtonText:"Ok",headerText:"Errori di inserimento dati!",bodyText:i}).then(function(){});else{var r={id_volontari_servizi:e.item.id_volontari_servizi,data_servizi:e.item.data_servizi,da_ora_servizi:e.item.da_ora_servizi,a_ora_servizi:e.item.a_ora_servizi,note_servizi:e.item.note_servizi,rapporto_servizi:e.item.rapporto_servizi},a=n.allUrl("servizi","/api1/servizi");a.post(r).then(function(e){var i={type:1,headerText:"Messaggio",bodyText:"Dato inserito con successo"};o.showModal({},i).then(function(){t.go("view",{id:e.id_servizi})},function(){t.go("view",{id:e.id_servizi})})},function(){})}},e.popupDate=function(t){t.preventDefault(),t.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.$watch("item.id_utenti",function(t){var i=n.all("volontariAll");i.getList({id_volontari_utenti:t}).then(function(t){e.volontariList=t})})}]).controller("InfiniteCtrl",["$scope","$location","Restangular","$filter","Session",function(e,t,i,n,o){e.totalPages=0,e.itemsCount=0,e.currentPage=1,e.totalItems=0,e.pageSize=8,e.startPage=0,e.openedPopupDate=!1,e.utentiList=[],e.filterCriteria={pageNumber:1,count:0,limit:e.pageSize,start:0,sortDir:"asc",sortedBy:"id",id_utenti_selezione:o.isAdmin?0:o.id_utenti,mese_selezione:0,anno_selezione:0};var r=i.all("utentiAll");r.getList().then(function(t){o.isAdmin?(e.utentiList=t,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"}),e.id_utenti_selezione=0):(e.id_utenti_selezione=o.id_utenti,e.filterCriteria.id_utenti_selezione=o.id_utenti,e.utentiList=[],e.utentiList.push({id_utenti:o.id_utenti,nome_breve_utenti:o.nome_breve_utenti}))}),e.fetchResult=function(){var t=i.all("serviziAll");e.filterCriteria.count=1,t.getList(e.filterCriteria).then(function(t){e.totalItems=t.length>0?t[0].totalItems:0},function(){e.totalItems=0});var n=(e.currentPage-1)*e.pageSize;return e.filterCriteria.count=0,e.filterCriteria.start=n,t.getList(e.filterCriteria).then(function(t){e.items=t},function(){e.items=[]})},e.selectPage=function(){var t=e.currentPage;e.currentPage=t,e.filterCriteria.pageNumber=t,e.fetchResult()},e.selectPage(1),e.$watch("id_utenti_selezione",function(t){o.isAdmin&&(e.filterCriteria.id_utenti_selezione=t,e.currentPage=1,e.filterCriteria.pageNumber=e.currentPage,e.fetchResult())}),e.$watch("data_servizi_selezione",function(t){t?(e.filterCriteria.mese_selezione=n("date")(t,"MM"),e.filterCriteria.anno_selezione=n("date")(t,"yyyy")):(e.filterCriteria.mese_selezione=0,e.filterCriteria.anno_selezione=0),e.currentPage=1,e.filterCriteria.pageNumber=e.currentPage,e.fetchResult()}),e.popupDate=function(t){t.preventDefault(),t.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.editItem=function(e){t.path("/edit/"+e)}}]).controller("ReportCtrl",["$scope","Restangular","modalService","rService","$filter","$http","$sce","Session",function(e,t,i,n,o,r,a,s){if(e.timeCalculated=0,e.item={},e.item.tipo_report=1,e.openedPopupDate=!1,s.isAdmin){var l=t.all("utentiAll");l.getList().then(function(t){e.utentiList=t,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"})})}else e.utentiList=[],e.utentiList.push({id_utenti:s.id_utenti,nome_breve_utenti:s.nome_breve_utenti}),e.item.id_utenti=s.id_utenti;var u=t.all("volontariAll");u.getList().then(function(t){e.volontariList=t}),e.timechanged=function(){e.timeCalculated=n.time_diff(e.item.da_ora_servizi,e.item.a_ora_servizi)},e.popupDate=function(t){t.preventDefault(),t.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.build_report=function(){var t="";if(e.item.id_utenti||(t="Selezionare una Associazione"),e.item.data_servizi||(t="Selezionare una data!"),""!=t)i.showModal({},{closeButtonText:"Cancel",actionButtonText:"Ok",headerText:"Errori di inserimento dati!",bodyText:t}).then(function(){});else{var n,r={id_utenti:e.item.id_utenti,tipo_report:e.item.tipo_report,data_servizi:e.item.data_servizi,relazione_servizio:e.item.relazione_servizio,utenti_controllati:e.item.utenti_controllati,dati_auto:e.item.dati_auto,giorno_servizi:o("date")(e.item.data_servizi,"dd"),mese_servizi:o("date")(e.item.data_servizi,"MM"),anno_servizi:o("date")(e.item.data_servizi,"yyyy")},a=(JSON.stringify(r),"");for(n in r){if(!r.hasOwnProperty(n))return;0!==a.length&&(a+="&"),a+=n+"="+encodeURIComponent(r[n])}var s="/pdf/?"+a;new PDFObject({url:s}).embed("PDF_DIV_CONTAINER")}},e.$watch("item.data_servizi",function(i){var n=t.all("serviziAll");n.getList({limit:50,id_utenti_selezione:e.item.id_utenti,mese_selezione:o("date")(i,"MM"),anno_selezione:o("date")(i,"yyyy")}).then(function(t){e.serviziList=[];for(var i=0;i<t.length;i++)t[i].nome_volontario_completo=t[i].nome_volontari+" "+t[i].cognome_volontari,e.serviziList.push(t[i])})}),e.$watch("item.id_utenti",function(i){var n=t.all("volontariAll");n.getList({id_volontari_utenti:i}).then(function(t){e.volontariList=t})})}]).controller("LoginController",["$scope","$rootScope","AUTH_EVENTS","AuthService",function(e,t,i,n){e.credentials={username:"",password:""},e.login=function(e){n.login(e).then(function(){t.$broadcast(i.loginSuccess)},function(){t.$broadcast(i.loginFailed)})},e.logout=function(e){n.logout(e).then(function(){t.$broadcast(i.loginSuccess)},function(){t.$broadcast(i.loginFailed)})}}]).controller("TestController",["$scope","Session","Restangular","$rootScope","$modal","$filter","$location",function(e,t,i,n,o,r,a){e.totalPages=0,e.itemsCount=0,e.currentPage=1,e.totalItems=0,e.pageSize=3,e.startPage=0,e.openedPopupDate=!1,e.utentiList=[],e.filterCriteria={pageNumber:1,count:0,limit:e.pageSize,start:0,sortDir:"asc",sortedBy:"id",id_utenti_selezione:0,mese_selezione:0,anno_selezione:0};var s=i.all("utentiAll");s.getList().then(function(i){t.isAdmin?(e.utentiList=i,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"}),e.id_utenti_selezione=0):(e.id_utenti_selezione=t.id_utenti,e.utentiList=[],e.utentiList.push({id_utenti:t.id_utenti,nome_breve_utenti:t.nome_breve_utenti}))}),e.fetchResult=function(){var t=i.all("serviziAll");e.filterCriteria.count=1,t.getList(e.filterCriteria).then(function(t){e.totalItems=t.length>0?t[0].totalItems:0},function(){e.totalItems=0});var n=(e.currentPage-1)*e.pageSize;return e.filterCriteria.count=0,e.filterCriteria.start=n,t.getList(e.filterCriteria).then(function(t){e.items=t},function(){e.items=[]})},e.selectPage=function(){var t=e.currentPage;e.currentPage=t,e.filterCriteria.pageNumber=t,e.fetchResult()},e.selectPage(1),e.$watch("id_utenti_selezione",function(i){t.isAdmin&&(e.filterCriteria.id_utenti_selezione=i,e.currentPage=1,e.filterCriteria.pageNumber=e.currentPage,e.fetchResult())}),e.$watch("data_servizi_selezione",function(t){t?(e.filterCriteria.mese_selezione=r("date")(t,"MM"),e.filterCriteria.anno_selezione=r("date")(t,"yyyy")):(e.filterCriteria.mese_selezione=0,e.filterCriteria.anno_selezione=0),e.currentPage=1,e.filterCriteria.pageNumber=e.currentPage,e.fetchResult()}),e.popupDate=function(t){t.preventDefault(),t.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.editItem=function(e){a.path("/edit/"+e)},e.items=["item1","item2","item3"];var l=function(e,t,i){e.items=i,e.selected={item:e.items[0]},e.ok=function(){t.close(e.selected.item)},e.cancel=function(){t.dismiss("cancel")}};e.open=function(t){var i=o.open({templateUrl:"myModalContent.html",controller:l,size:t,resolve:{items:function(){return e.items}}});i.result.then(function(t){e.selected=t},function(){})}}]);
"use strict";angular.module("myApp.directives",[]).directive("appVersion",["version",function(e){return function(t,i){i.text(e)}}]).directive("browserVersion",["version",function(){return function(){var e=navigator.userAgent;this.IsIE=!1,this.IsOn=void 0,this.Version=void 0,e.indexOf("MSIE 7.0")>-1&&(this.IsIE=!0,this.IsOn=!0,e.indexOf("Trident/6.0")>-1?this.Version="IE10":e.indexOf("Trident/5.0")>-1?this.Version="IE9":e.indexOf("Trident/4.0")>-1?this.Version="IE8":(this.IsOn=!1,this.Version="IE7"))}}]).directive("fancySelect",["$ionicModal",function(e){return{restrict:"E",templateUrl:"fancy-select.html",scope:{items:"=",text:"=",value:"=",callback:"&"},link:function(t,i,n){t.multiSelect="true"===n.multiSelect?!0:!1,t.allowEmpty="false"===n.allowEmpty?!1:!0,t.headerText=n.headerText||"",t.labelText=n.labelText||"",t.defaultText=t.text||"",t.noteText=n.noteText||"",t.noteImg=n.noteImg||"",t.noteImgClass=n.noteImgClass||"",e.fromTemplateUrl("fancy-select-items.html",{scope:t}).then(function(e){t.modal=e}),t.validate=function(){1==t.multiSelect&&(t.value="",t.text="",jQuery.each(t.items,function(e,i){i.checked&&(t.value=t.value+i.id+",",t.text=t.text+"\r"+i.text+", ")}),t.value=t.value.substr(0,t.value.length-1),t.text=t.text.substr(0,t.text.length-2)),("undefined"==typeof t.value||""==t.value||null==t.value)&&(0==t.allowEmpty?(t.value=t.items[0].id,t.text=t.items[0].text,t.items[0].checked=!0):t.text=t.defaultText),t.hideItems(),"function"==typeof t.callback&&t.callback(t.value)},t.showItems=function(e){e.preventDefault(),t.modal.show()},t.hideItems=function(){t.modal.hide()},t.$on("$destroy",function(){t.modal.remove()}),t.validateSingle=function(e){t.text=e.text,t.value=e.id,t.hideItems(),"function"==typeof t.callback&&t.callback(t.value)}}}}]);
"use strict";angular.module("myApp.filters",[]).filter("interpolate",["version",function(t){return function(e){return String(e).replace(/\%VERSION\%/gm,t)}}]).filter("asDate",function(){return function(t){return new Date(t)}}).filter("datetmUTC",function(t){return function(e){if(null==e)return"";var n=t("date")(new Date(e),"MMM dd yyyy - HH:mm:ss"),r=new Date(n);return r.getTime()}});
"use strict";angular.module("myApp.controllers").controller("AppCtrl",["$scope","USER_ROLES","AUTH_EVENTS","$rootScope","AuthService","modalService","Session","Restangular","$state","$ionicPopup","$ionicSideMenuDelegate",function(e,t,o,n,i,c,r,a,u,l,s){e.currentUser=null,e.userRoles=t,e.isAuthorized=i.isAuthorized,e.go=function(e){u.go(e)},window.ionic,e.toggleLeft=function(){s.toggleLeft(e.$$childHead)},n.base_url="http://federadati.provincia.rimini.it:3000",a.setBaseUrl(n.base_url+"/apiQ"),n.$on(o.loginSuccess,function(){e.currentUser=r.nome_breve_utenti,a.setDefaultRequestParams({apiKey:r.token}),u.go("menu.list")}),n.$on(o.logoutSuccess,function(){e.currentUser="",a.setDefaultRequestParams({apiKey:""}),u.go("menu.home")}),n.$on(o.loginFailed,function(){var e=l.alert({title:"Login errato",template:"Immettere nome utente e password corrette"});e.then(function(){u.go("menu.home")})}),n.$on(o.notAuthenticated,function(){e.currentUser=r.nome_breve_utenti;var t=l.alert({title:"Utente non autenticato",template:"Immettere nome utente e password"});t.then(function(){u.go("menu.home")})}),n.$on("$stateChangeStart",function(e,t){t.accessLogged&&(i.isAuthenticated()||(e.preventDefault(),n.$broadcast(o.notAuthenticated)))})}]).controller("LoginController",["$scope","$rootScope","AUTH_EVENTS","AuthService","$state",function(e,t,o,n,i){e.credentials={username:"",password:""},e.leftButtons=[{type:"button-icon button-clear ion-navicon",tap:function(){$ionicSideMenuDelegate.toggleLeft(e.$$childHead)}}],e.navTitle='<span class="item-calm">Gestione Volontari</span>',e.goto_help=function(){i.go("menu.help")},e.login=function(e){n.login(e).then(function(){t.$broadcast(o.loginSuccess)},function(){t.$broadcast(o.loginFailed)})},e.logout=function(e){n.logout(e).then(function(){t.$broadcast(o.logoutSuccess)},function(){t.$broadcast(o.logoutSuccess)})}}]).controller("AboutController",["$scope","$rootScope","AUTH_EVENTS","AuthService","Session","$location","$ionicLoading","$http","$ionicPopup",function(e,t,o,n,i,c,r,a,u){e.navTitle=i.nome_breve_utenti,e.base_url=t.base_url,e.$location={},angular.forEach("protocol host port path search hash".split(" "),function(t){e.$location[t]=function(){var e=c[t].call(c);return angular.isObject(e)?angular.toJson(e):e}}),e.test_connection=function(){r.show({template:"Loading..."}),a({method:"GET",url:t.base_url+"/mv/testconnection"}).success(function(){var e=u.alert({title:"OK!",template:"Test di connessione ok"});e.then(function(){})}).error(function(){var e=u.alert({title:"Errori!",template:"Test di connessione FALLITO"});e.then(function(){})}),r.hide()}}]).controller("HelpController",["$scope","$rootScope","AUTH_EVENTS","AuthService","Session","$location","$ionicLoading","$http","$ionicPopup","$ionicSlideBoxDelegate","$state",function(e,t,o,n,i,c,r,a,u,l,s){e.goto_login=function(){s.go("menu.login")}}]);
"use strict";angular.module("myApp.controllers").controller("ReportCtrlMobile",["$scope","$rootScope","Restangular","modalService","rService","$filter","$http","$sce","Session","$ionicPopup",function(e,t,i,n,o,r,a,l,s,u){if(e.timeCalculated=0,e.item={},e.item.tipo_report=1,e.openedPopupDate=!1,e.showDownloadButton=!1,e.showDownloadUrl=!1,e.showGoogleViewUrl="",s.isAdmin){var c=i.all("utentiAll");c.getList().then(function(t){e.utentiList=t,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"})})}else e.utentiList=[],e.utentiList.push({id_utenti:s.id_utenti,nome_breve_utenti:s.nome_breve_utenti}),e.item.id_utenti=s.id_utenti;e.popupDate=function(t){t.preventDefault(),t.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.view_pdf=function(){window.open(e.showGoogleViewUrl,"_blank","location=no")},e.build_report=function(){var n="";if(n=e.item.id_utenti>=0?"":"Selezionare una Associazione",e.item.data_servizi||(n="Selezionare una data!"),""!=n){var o=u.alert({title:"Errori di input",template:n});o.then(function(){})}else{var a={id_utenti:e.item.id_utenti,tipo_report:e.item.tipo_report,data_servizi:e.item.data_servizi,relazione_servizio:e.item.relazione_servizio,utenti_controllati:e.item.utenti_controllati,dati_auto:e.item.dati_auto,giorno_servizi:r("date")(e.item.data_servizi,"dd"),mese_servizi:r("date")(e.item.data_servizi,"MM"),anno_servizi:r("date")(e.item.data_servizi,"yyyy"),nome_file:(new Date).getTime(),mobile:1},l=i.allUrl("pdf","/pdf");l.getList(a).then(function(i){if("NODATATODISPLAY"==i[0].report_filename){var n=u.alert({title:"Messaggio",template:"Nessun dato da visualizzare"});n.then(function(){})}else e.showDownloadButton=!0,e.showDownloadButtonText="Scarica la stampa pdf ("+i[0].report_filename+")",e.showDownloadUrl="/pdfget?nomefile="+i[0].report_filename,e.showGoogleViewUrl="https://docs.google.com/viewer?url="+encodeURIComponent(t.base_url+e.showDownloadUrl)},function(){})}}}]).controller("TestController",["$scope","Session","Restangular","$rootScope","$modal","$filter","$location",function(e,t,i,n,o,r,a){e.totalPages=0,e.itemsCount=0,e.currentPage=1,e.totalItems=0,e.pageSize=3,e.startPage=0,e.openedPopupDate=!1,e.utentiList=[],e.filterCriteria={pageNumber:1,count:0,limit:e.pageSize,start:0,sortDir:"asc",sortedBy:"id",id_utenti_selezione:0,mese_selezione:0,anno_selezione:0};var l=i.all("utentiAll");l.getList().then(function(i){t.isAdmin?(e.utentiList=i,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"}),e.id_utenti_selezione=0):(e.id_utenti_selezione=t.id_utenti,e.utentiList=[],e.utentiList.push({id_utenti:t.id_utenti,nome_breve_utenti:t.nome_breve_utenti}))}),e.fetchResult=function(){var t=i.all("serviziAll");e.filterCriteria.count=1,t.getList(e.filterCriteria).then(function(t){e.totalItems=t.length>0?t[0].totalItems:0},function(){e.totalItems=0});var n=(e.currentPage-1)*e.pageSize;return e.filterCriteria.count=0,e.filterCriteria.start=n,t.getList(e.filterCriteria).then(function(t){e.items=t},function(){e.items=[]})},e.selectPage=function(){var t=e.currentPage;e.currentPage=t,e.filterCriteria.pageNumber=t,e.fetchResult()},e.selectPage(1),e.$watch("id_utenti_selezione",function(i){t.isAdmin&&(e.filterCriteria.id_utenti_selezione=i,e.currentPage=1,e.filterCriteria.pageNumber=e.currentPage,e.fetchResult())}),e.$watch("data_servizi_selezione",function(t){t?(e.filterCriteria.mese_selezione=r("date")(t,"MM"),e.filterCriteria.anno_selezione=r("date")(t,"yyyy")):(e.filterCriteria.mese_selezione=0,e.filterCriteria.anno_selezione=0),e.currentPage=1,e.filterCriteria.pageNumber=e.currentPage,e.fetchResult()}),e.popupDate=function(t){t.preventDefault(),t.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.editItem=function(e){a.path("/edit/"+e)},e.items=["item1","item2","item3"];var s=function(e,t,i){e.items=i,e.selected={item:e.items[0]},e.ok=function(){t.close(e.selected.item)},e.cancel=function(){t.dismiss("cancel")}};e.open=function(t){var i=o.open({templateUrl:"myModalContent.html",controller:s,size:t,resolve:{items:function(){return e.items}}});i.result.then(function(t){e.selected=t},function(){})}}]);
"use strict";angular.module("myApp.controllers").controller("EditItemCtrlRelazioni",["$scope","$filter","$state","$stateParams","Restangular","modalService","rService","Session","$ionicPopup",function(e,i,t,n,o,a,r,l,_){var u=t.current.configAction;if(e.configAction=u,e.item={},e.openedPopupDate=!1,"edit"==u||"view"==u)var d=o.all("rapportiAll"),m={limit:50,id_rapporti_selezione:n.id};else var d=o.all("serviziAll"),m={limit:50,id_servizi_selezione:n.id};d.getList(m).then(function(t){if("edit"==u||"view"==u?(e.item.id=n.id,e.item.id_servizi=t[0].id_servizi,e.item.id_utenti=t[0].id_utenti,e.item.nome_breve_utenti=t[0].nome_breve_utenti,e.item.elenco_id_volontari=t[0].elenco_id_volontari,e.item.elenco_volontari=t[0].elenco_volontari,e.item.lista_volontari_relazioni=t[0].elenco_id_volontari.split(","),e.item.data_relazioni=i("date")(t[0].data_relazioni,"yyyy-MM-dd"),e.item.a_ora_relazioni=i("date")(t[0].a_ora_relazioni,"HH:mm"),e.item.da_ora_relazioni=i("date")(t[0].da_ora_relazioni,"HH:mm"),e.timeCalculated=r.time_diff(e.item.da_ora_relazioni,e.item.a_ora_relazioni),e.item.auto_relazioni=t[0].auto_relazioni,e.item.note_relazioni=t[0].note_relazioni,e.item.rapporto_relazioni=t[0].rapporto_relazioni,e.item.annullato_relazioni=t[0].annullato_relazioni):(e.item.id_servizi=n.id,e.item.id_utenti=t[0].id_utenti,e.item.nome_breve_utenti=t[0].nome_breve_utenti,e.item.elenco_id_volontari=t[0].elenco_id_volontari,e.item.elenco_volontari=t[0].elenco_volontari,e.item.lista_volontari_relazioni=t[0].elenco_id_volontari.split(","),e.item.elenco_id_volontari=t[0].elenco_id_volontari,e.item.data_relazioni=i("date")(t[0].data_servizi,"yyyy-MM-dd"),e.item.a_ora_relazioni=i("date")(t[0].a_ora_servizi,"HH:mm"),e.item.da_ora_relazioni=i("date")(t[0].da_ora_servizi,"HH:mm"),e.timeCalculated=r.time_diff(e.item.da_ora_relazioni,e.item.a_ora_relazioni),e.item.auto_relazioni=" -- NEW AUTO --",e.item.note_relazioni=" -- NEW NOTE --",e.item.rapporto_relazioni=" -- NEW RAPPORTO --",e.item.annullato_relazioni=0),"undefined"!=typeof e.item.id_utenti&&null!=e.item.id_utenti){var a=o.all("volontariAll");a.getList({id_volontari_utenti:e.item.id_utenti}).then(function(i){for(var n=[],o=i.length,a=0;o>a;a++){var r={id:i[a].id,checked:t[0].elenco_id_volontari.indexOf(i[a].id)>-1?!0:!1,text:i[a].nome_completo_volontari};n.push(r)}e.volontariList=n})}if(l.isAdmin){var _=o.all("utentiAll");_.getList().then(function(i){e.utentiList=i;for(var t=[],n=i.length,o=0;n>o;o++){var a={id:i[o].id_utenti,checked:i[o].id_utenti===e.item.id_utenti?!0:!1,text:i[o].nome_breve_utenti};t.push(a)}e.utentiList=t})}else{e.utentiList=[];var d=[],m={id:l.id_utenti,checked:!0,text:l.nome_breve_utenti};d.push(m),e.utentiList=d,e.item.id_utenti=l.id_utenti,e.item.nome_breve_utenti=l.nome_breve_utenti}}),e.toggleRight=function(){t.go("menu.listRelazioni")},e.master={},e.timeCalculated=0,e.timechanged=function(){e.timeCalculated=r.time_diff(e.item.da_ora_relazioni,e.item.a_ora_relazioni),e.timeCalculated<1&&(e.timeCalculated=e.timeCalculated+24)},e.cancel_action=function(e){var i=_.confirm({title:"Messaggio",template:"Annullare il presente elemento?"});i.then(function(i){i&&o.oneUrl("relazioni","/api1/relazioni/"+e.id).get().then(function(i){i.annullato_relazioni=1,o.setBaseUrl("/api1"),i.customPUT({annullato_relazioni:1},e.id,{},{}),o.setBaseUrl("/apiQ"),t.go("menu.listRelazioni")})})},e.save_action=function(){var i="";if("undefined"==typeof e.item.elenco_id_volontari&&(i="Selezionare un volontario!"),""==e.item.elenco_id_volontari&&(i="Selezionare un volontario!"),0==e.item.lista_volontari_relazioni.length&&(i="Selezionare un volontario!"),""!=i){var n=_.alert({title:"Errori di input",template:i});n.then(function(){})}else{var a={id_utenti:e.item.id_utenti,id_servizi:e.item.id_servizi,data_relazioni:e.item.data_relazioni,da_ora_relazioni:"1900-01-01T"+e.item.da_ora_relazioni+":00.000Z",a_ora_relazioni:"1900-01-01T"+e.item.a_ora_relazioni+":00.000Z",note_relazioni:e.item.note_relazioni,auto_relazioni:e.item.auto_relazioni,rapporto_relazioni:e.item.rapporto_relazioni,lista_volontari:e.item.lista_volontari_relazioni},r=o.allUrl("relazioni","/api1/relazioni");r.post(a).then(function(e){var i=_.alert({title:"Messaggio",template:"Dato inserito con successo!"});i.then(function(){t.go("menu.editRelazioni",{id:e.id})})},function(){})}},e.popupDate=function(i){i.preventDefault(),i.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.debug_action=function(){},e.$watch("item.id_utenti",function(){})}]).controller("InfiniteCtrlRelazioni",["$scope","$location","Restangular","$filter","Session","$ionicPopup","$ionicPopover",function(e,i,t,n,o,a,r){e.totalPages=0,e.itemsCount=0,e.currentPage=1,e.totalItems=0,e.pageSize=8,e.startPage=0,e.openedPopupDate=!1,e.utentiList=[],e.filterCriteria={pageNumber:1,count:0,limit:e.pageSize,start:0,sortDir:"asc",sortedBy:"id",id_utenti_selezione:o.isAdmin?0:o.id_utenti,mese_selezione:0,anno_selezione:0};var l=t.all("utentiAll");l.getList().then(function(i){o.isAdmin?(e.utentiList=i,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"}),e.id_utenti_selezione=0):(e.id_utenti_selezione=o.id_utenti,e.filterCriteria.id_utenti_selezione=o.id_utenti,e.utentiList=[],e.utentiList.push({id_utenti:o.id_utenti,nome_breve_utenti:o.nome_breve_utenti}))}),e.fetchResult=function(){var i=t.all("rapportiAll");e.filterCriteria.count=1,i.getList(e.filterCriteria).then(function(i){e.totalItems=i.length>0?i[0].totalItems:0},function(){e.totalItems=0});var n=(e.currentPage-1)*e.pageSize;return e.filterCriteria.count=0,e.filterCriteria.start=n,i.getList(e.filterCriteria).then(function(i){e.items=i},function(){e.items=[]})},e.selectPage=function(){var i=e.currentPage;e.currentPage=i,e.filterCriteria.pageNumber=i,e.fetchResult()},e.selectPage(1),e.$watch("id_utenti_selezione",function(){}),e.$watch("data_servizi_selezione",function(i){i?(e.filterCriteria.mese_selezione=n("date")(i,"MM"),e.filterCriteria.anno_selezione=n("date")(i,"yyyy")):(e.filterCriteria.mese_selezione=0,e.filterCriteria.anno_selezione=0),e.currentPage=1,e.filterCriteria.pageNumber=e.currentPage,e.fetchResult()}),e.popupDate=function(i){i.preventDefault(),i.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.editItem=function(e){i.path("/menu/editRelazioni/"+e)},e.toggleRight=function(){var e=a.alert({title:"*TODO*",template:"TODO"});e.then(function(){})},e.OpenFilterFromPopover=function(){e.popover.hide()};var _="<ion-popover-view>";_+="<ion-content>",_+='<div class="list">',_+='<a class="item item-icon-left" ng-click="OpenFilterFromPopover()"><i class="icon ion-funnel"></i>Filtro</a>',_+="</div>",_+="</ion-content>",_+="</ion-popover-view>",e.popover=r.fromTemplate(_,{scope:e}),e.$on("$destroy",function(){e.popover.remove()})}]);
"use strict";angular.module("myApp.controllers",[]);
"use strict";angular.module("myApp.services",[]).service("rService",[function(){this.time_diff=function(t,e){var n=e-t,i=n,o=Math.floor(i/1e3/60/60);i-=1e3*o*60*60;var r=Math.floor(i/1e3/60);i-=1e3*r*60;var s=Math.floor(i/1e3);return i-=1e3*s,(o+":"+r).toString()}}]).service("version",[function(){return"0.0.1"}]).service("modalService",["$modal",function(t){var e={backdrop:!0,keyboard:!0,modalFade:!0,templateUrl:"partials/modal.html"},n={type:2,closeButtonText:"Close",actionButtonText:"OK",headerText:"Proceed?",bodyText:"Perform this action?"};this.showModal=function(t,e){return t||(t={}),t.backdrop="static",this.show(t,e)},this.show=function(i,o){var r={},s={};return angular.extend(r,e,i),angular.extend(s,n,o),r.controller||(r.controller=function(t,e){t.modalOptions=s,t.modalOptions.ok=function(t){e.close(t)},t.modalOptions.close=function(){e.dismiss("cancel")}}),t.open(r).result}}]).factory("AuthService",["API_PROVIDER_URL","$http","Session","$rootScope",function(t,e,n,i){return{login:function(t){return e.post(i.base_url+"/api2/login",t).then(function(t){n.create(t.data[0].id_utenti,t.data[0].nome_breve_utenti,t.data[0].token,t.data[0].isadmin_utenti)})},logout:function(t){return e.post(i.base_url+"/api2/logout",t).then(function(){n.destroy()})},isAuthenticated:function(){return!!n.id_utenti},isAuthorized:function(t){return angular.isArray(t)||(t=[t]),this.isAuthenticated()&&-1!==t.indexOf(n.userRole)}}}]).service("Session",function(){return this.create=function(t,e,n,i){this.id_utenti=t,this.nome_breve_utenti=e,this.token=n,this.isAdmin=i},this.destroy=function(){this.id_utenti=null,this.nome_breve_utenti=null,this.token=null,this.isAdmin=!1},this});
"use strict";angular.module("myApp.controllers").controller("EditItemCtrl",["$scope","$filter","$state","$stateParams","Restangular","modalService","rService","Session","$ionicPopup",function(e,i,t,n,o,a,r,l,s){var u=t.current.configAction;if(e.configAction=u,e.item={},e.openedPopupDate=!1,e.toggleRight=function(){t.go("menu.list")},e.rightButtons=[{type:"button-icon button-clear ion-email",tap:function(){}}],"edit"==u||"view"==u||"new"==u){"new"==u&&(n.id=0);var d=o.all("serviziAll");d.getList({limit:50,id_servizi_selezione:n.id}).then(function(t){if(e.item=t[0],e.item.data_servizi=i("date")(t[0].data_servizi,"yyyy-MM-dd"),e.item.a_ora_servizi=t[0].a_ora_servizi.substr(11,5),e.item.da_ora_servizi=t[0].da_ora_servizi.substr(11,5),e.item.id_utenti=t[0].id_utenti,e.item.lista_volontari_servizi=t[0].elenco_id_volontari.split(","),e.timeCalculated=r.time_diff(e.item.da_ora_servizi,e.item.a_ora_servizi),e.elenco_id_rapporti_servizio=t[0].elenco_id_rapporti_servizio,e.id_rapporto_valido_servizio=t[0].id_rapporto_valido_servizio,e.item.annullato_servizi=t[0].annullato_servizi,"new"==u&&(e.item=[],e.item.id_utenti=null,e.item.lista_volontari_servizi=[],e.item.data_servizi=i("date")(new Date,"yyyy-MM-dd"),e.item.a_ora_servizi=i("date")(new Date,"HH:mm"),e.item.da_ora_servizi=i("date")(new Date,"HH:mm"),e.item.annullato_servizi=0),"undefined"!=typeof e.item.id_utenti&&null!=e.item.id_utenti){var n=o.all("volontariAll");n.getList({id_volontari_utenti:e.item.id_utenti}).then(function(i){for(var n=[],o=i.length,a=0;o>a;a++){var r={id:i[a].id,checked:t[0].elenco_id_volontari.indexOf(i[a].id)>-1?!0:!1,text:i[a].nome_completo_volontari};n.push(r)}e.volontariList=n})}if(l.isAdmin){var a=o.all("utentiAll");a.getList().then(function(i){e.utentiList=i;for(var t=[],n=i.length,o=0;n>o;o++){var a={id:i[o].id_utenti,checked:i[o].id_utenti===e.item.id_utenti?!0:!1,text:i[o].nome_breve_utenti};t.push(a)}e.utentiList=t})}else{e.utentiList=[];var s=[],d={id:l.id_utenti,checked:!0,text:l.nome_breve_utenti};s.push(d),e.utentiList=s,e.item.id_utenti=l.id_utenti,e.item.nome_breve_utenti=l.nome_breve_utenti}})}e.master={},e.timeCalculated=0,e.timechanged=function(){e.timeCalculated=r.time_diff(e.item.da_ora_servizi,e.item.a_ora_servizi),e.timeCalculated<1&&(e.timeCalculated=e.timeCalculated+24)},e.cancel_action=function(e){var i=s.confirm({title:"Messaggio",template:"Annullare il presente elemento?"});i.then(function(i){i&&o.oneUrl("servizi","/api1/servizi/"+e.id).get().then(function(i){i.annullato_servizi=1,o.setBaseUrl("/api1"),i.customPUT({annullato_servizi:1},e.id,{},{}),o.setBaseUrl("/apiQ"),t.go("menu.list")})})},e.save_action=function(){var i="";if("undefined"==typeof e.item.elenco_id_volontari&&(i="Selezionare un volontario!"),""==e.item.elenco_id_volontari&&(i="Selezionare un volontario!"),!l.isAdmin&&e.item.data_servizi<new Date&&(i="Non è possibile selezionare date del servizio precedenti a quelle odierna."),""!=i){var n=s.alert({title:"Errori di input",template:i});n.then(function(){})}else{var a={id_utenti:e.item.id_utenti,data_servizi:e.item.data_servizi,da_ora_servizi:"1900-01-01T"+e.item.da_ora_servizi+":00.000Z",a_ora_servizi:"1900-01-01T"+e.item.a_ora_servizi+":00.000Z",note_servizi:e.item.note_servizi,lista_volontari:e.item.elenco_id_volontari.split(","),rapporto_servizi:e.item.rapporto_servizi},r=o.allUrl("servizi","/api1/servizi");r.post(a).then(function(e){var i=s.alert({title:"Messaggio",template:"Dato inserito con successo!"});i.then(function(){t.go("menu.edit",{id:e.id})})},function(){})}},e.new_relazione_action=function(e){t.go("menu.newRelazioni",{id:e})},e.goto_relazione_action=function(e){t.go("menu.editRelazioni",{id:e})},e.popupDate=function(i){i.preventDefault(),i.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.debug_action=function(){},e.$watch("item.id_utenti",function(i){if("new"==u&&"undefined"!=typeof i&&null!=i){var t=o.all("volontariAll");t.getList({id_volontari_utenti:i}).then(function(i){for(var t=[],n=i.length,o=0;n>o;o++){var a={id:i[o].id,checked:!1,text:i[o].nome_completo_volontari};t.push(a)}e.item.elenco_volontari="",e.item.elenco_id_volontari="",e.volontariList=t})}}),e.$watch("item.volontariList1",function(){})}]).controller("InfiniteCtrl",["$scope","$location","Restangular","$filter","Session","$ionicModal","$ionicSideMenuDelegate","$ionicPopover",function(e,i,t,n,o,a,r,l){e.totalPages=0,e.itemsCount=0,e.currentPage=1,e.totalItems=0,e.pageSize=1e5,e.startPage=0,e.openedPopupDate=!1,e.utentiList=[],e.id_utenti_selezione=0,a.fromTemplateUrl("partials/sortModal.html",function(i){e.sortModal=i},{scope:e,animation:"slide-in-up"}),e.openSortModal=function(){e.sortModal.show()},e.closeSortModal=function(){e.sortModal.hide()},e.saveSort=function(){e.filterCriteria.id_utenti_selezione=this.id_utenti_selezione,e.filterTerm=this.filterTerm,e.sortBy=this.sortBy,e.sortModal.hide(),e.fetchResult()},e.OpenFilter=function(){e.sortModal.show()},e.filterCriteria={pageNumber:1,count:0,limit:e.pageSize,start:0,sortDir:"asc",sortedBy:"id",id_utenti_selezione:o.isAdmin?0:o.id_utenti,mese_selezione:0,anno_selezione:0};var s=t.all("utentiAll");s.getList().then(function(i){o.isAdmin?(e.utentiList=i,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"}),e.id_utenti_selezione=0):(e.id_utenti_selezione=o.id_utenti,e.filterCriteria.id_utenti_selezione=o.id_utenti,e.utentiList=[],e.utentiList.push({id_utenti:o.id_utenti,nome_breve_utenti:o.nome_breve_utenti}))}),e.fetchResult=function(){var i=t.all("serviziAll");e.filterCriteria.count=1,i.getList(e.filterCriteria).then(function(i){e.totalItems=i.length>0?i[0].totalItems:0},function(){e.totalItems=0});var n=(e.currentPage-1)*e.pageSize;return e.filterCriteria.count=0,e.filterCriteria.start=n,i.getList(e.filterCriteria).then(function(i){e.items=i},function(){e.items=[]})},e.selectPage=function(){var i=e.currentPage;e.currentPage=i,e.filterCriteria.pageNumber=i,e.fetchResult()},e.selectPage(1),e.editItem=function(e){i.path("/menu/edit/"+e)},e.editRelazioni=function(e){i.path("/menu/editRelazioni/"+e)},e.newRelazioni=function(){i.path("/menu/new")},e.debug_action=function(){},e.newRelazioniFromPopover=function(){e.popover.remove(),i.path("/menu/new")},e.OpenFilterFromPopover=function(){e.popover.hide(),e.sortModal.show()};var u="<ion-popover-view>";u+="<ion-content>",u+='<div class="list">',u+='<a class="item item-icon-left" ng-click="newRelazioniFromPopover()" ><i class="icon ion-plus-circled"></i> Nuovo elemento</a>',u+='<a class="item item-icon-left" ng-click="OpenFilterFromPopover()"><i class="icon ion-funnel"></i>Filtro</a>',u+="</div>",u+="</ion-content>",u+="</ion-popover-view>",e.popover=l.fromTemplate(u,{scope:e}),e.$on("$destroy",function(){e.popover.remove()})}]);