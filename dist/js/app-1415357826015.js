"use strict";angular.module("myApp",["ionic","ui.router","ngResource","restangular","myApp.filters","myApp.services","myApp.directives","myApp.controllers"]).config(["$stateProvider","$urlRouterProvider","RestangularProvider",function(t,e,i){e.otherwise("/menu/home"),t.state("menu",{url:"/menu","abstract":!0,templateUrl:"partials/menuM.html"}),t.state("menu.home",{url:"/home",views:{menuContent:{templateUrl:"partials/loginM.html",controller:"LoginController"}},accessLevel:"free1"}),t.state("menu.login",{url:"/login",views:{menuContent:{templateUrl:"partials/loginM.html",controller:"LoginController"}},accessLogged:!1}),t.state("menu.report",{url:"/report",views:{menuContent:{templateUrl:"partials/reportM.html",controller:"ReportCtrlMobile"}},accessLogged:!0,configAction:"new"}),t.state("menu.list",{url:"/list",views:{menuContent:{templateUrl:"partials/ListItemM.html",controller:"InfiniteCtrl"}},accessLogged:!0,configAction:"new"}),t.state("menu.new",{url:"/new",views:{menuContent:{templateUrl:"partials/EditItemM.html",controller:"EditItemCtrl"}},accessLogged:!0,configAction:"new"}),t.state("menu.edit",{url:"/edit/:id",views:{menuContent:{templateUrl:"partials/EditItemM.html",controller:"EditItemCtrl"}},accessLogged:!0,configAction:"edit"}),t.state("menu.view",{url:"/view/:id",views:{menuContent:{templateUrl:"partials/EditItemM.html",controller:"EditItemCtrl"}},accessLogged:!0,configAction:"view"}),t.state("menu.listRelazioni",{url:"/listRelazioni",views:{menuContent:{templateUrl:"partials/ListItemRelazioniM.html",controller:"InfiniteCtrlRelazioni"}},accessLogged:!0,configAction:"new"}),t.state("menu.newRelazioni",{url:"/newRelazioni/:id",views:{menuContent:{templateUrl:"partials/EditItemRelazioniM.html",controller:"EditItemCtrlRelazioni"}},accessLogged:!0,configAction:"new"}),t.state("menu.editRelazioni",{url:"/editRelazioni/:id",views:{menuContent:{templateUrl:"partials/EditItemRelazioniM.html",controller:"EditItemCtrlRelazioni"}},accessLogged:!0,configAction:"edit"}),t.state("menu.viewRelazioni",{url:"/viewRelazioni/:id",views:{menuContent:{templateUrl:"partials/EditItemRelazioniM.html",controller:"EditItemCtrlRelazioni"}},accessLogged:!0,configAction:"view"}),t.state("menu.about",{url:"/about",views:{menuContent:{templateUrl:"partials/aboutM.html",controller:"AboutController"}},accessLogged:!1,configAction:"view"}),t.state("menu.help",{url:"/help",views:{menuContent:{templateUrl:"partials/helpM.html",controller:"HelpController"}},accessLogged:!1,configAction:"view"}),t.state("test",{url:"/test",templateUrl:"partials/testM.html",controller:"TestController",accessLogged:!1,configAction:"view"}),i.setBaseUrl("/apiQ"),i.setDefaultRequestParams({apiKey:"**********************"}),i.setRestangularFields({id:"_id.$oid"}),i.setRequestInterceptor(function(t,e){return"put"===e?(t._id=void 0,t):t})}]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("API_PROVIDER_URL",{base_url:"http://10.0.1.157:3000",url2:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",editor:"editor",guest:"guest"});
"use strict";angular.module("myApp.services",[]).service("rService",[function(){this.time_diff=function(e,o){console.log("rService.time_diff ... "),console.log("t2"+o),console.log("t1"+e),console.log((o-e)/1e3/60/60);var t=o-e,n=t,i=Math.floor(n/1e3/60/60);n-=1e3*i*60*60;var s=Math.floor(n/1e3/60);n-=1e3*s*60;var l=Math.floor(n/1e3);return n-=1e3*l,(i+":"+s).toString()}}]).service("version",[function(){return"0.0.1"}]).factory("AuthService",["API_PROVIDER_URL","$http","Session","$rootScope",function(e,o,t,n){return{login:function(e){return console.log(n.base_url+"/api2/login"),o.post(n.base_url+"/api2/login",e).then(function(e){console.log("AuthService login then"),console.log(e),console.log(e.data[0].id_utenti),t.create(e.data[0].id_utenti,e.data[0].nome_breve_utenti,e.data[0].token,e.data[0].isadmin_utenti)})},logout:function(e){return console.log("AuthService logout"),console.log(n.base_url+"/api2/logout"),o.post(n.base_url+"/api2/logout",e).then(function(e){console.log("AuthService login then"),console.log(e),console.log(e.data.id_utenti),t.destroy()})},isAuthenticated:function(){return console.log("AuthService isAuthenticated"),!!t.id_utenti},isAuthorized:function(e){return console.log("AuthService isAuthorized"),angular.isArray(e)||(e=[e]),this.isAuthenticated()&&-1!==e.indexOf(t.userRole)}}}]).service("Session",function(){return this.create=function(e,o,t,n){console.log("Session create id:"+e),console.log("Session nome_breve_utenti:"+o),console.log("Session token:"+t),console.log("Session isAdmin:"+n),this.id_utenti=e,this.nome_breve_utenti=o,this.token=t,this.isAdmin=n},this.destroy=function(){console.log("Session destroy"),this.id_utenti=null,this.nome_breve_utenti=null,this.token=null,this.isAdmin=!1},this});
"use strict";angular.module("myApp.controllers",[]);
"use strict";angular.module("myApp.controllers").controller("AppCtrl",["$scope","USER_ROLES","AUTH_EVENTS","$rootScope","AuthService","Session","Restangular","$state","$ionicPopup","$ionicSideMenuDelegate",function(o,e,n,l,t,c,s,r,i,u){console.log("AppCtrl ... "),o.currentUser=null,o.userRoles=e,o.isAuthorized=t.isAuthorized,o.go=function(o){r.go(o)},window.ionic&&console.log("IONIC defined! : "+window.ionic.version),o.toggleLeft=function(){u.toggleLeft(o.$$childHead)},l.base_url="http://federadati.provincia.rimini.it:3000",console.log("WEB SERVICE WEB URL  : "+l.base_url),console.log("Restangular set base Url "+l.base_url+"/apiQ"),s.setBaseUrl(l.base_url+"/apiQ"),l.$on(n.loginSuccess,function(e,n){console.log("AppCtrl: AUTH_EVENTS.loginSuccess ... "),console.log(e),console.log(n),o.currentUser=c.nome_breve_utenti,s.setDefaultRequestParams({apiKey:c.token}),r.go("menu.list")}),l.$on(n.logoutSuccess,function(e,n){console.log("AppCtrl: AUTH_EVENTS.logourSuccess ... "),console.log(e),console.log(n),o.currentUser="",s.setDefaultRequestParams({apiKey:""}),r.go("menu.home")}),l.$on(n.loginFailed,function(o,e){console.log("AppCtrl: AUTH_EVENTS.loginFailed ... "),console.log(o),console.log(e);var n=i.alert({title:"Login errato",template:"Immettere nome utente e password corrette"});n.then(function(){console.log("AppCtrl : Login errato OK"),r.go("menu.home")})}),l.$on(n.notAuthenticated,function(e,n){console.log("AUTH_EVENTS.notAuthenticated ... "),console.log(e),console.log(n),o.currentUser=c.nome_breve_utenti;var l=i.alert({title:"Utente non autenticato",template:"Immettere nome utente e password"});l.then(function(){console.log("AppCtrl: alertPopup : OK"),r.go("menu.home")})}),l.$on("$stateChangeStart",function(o,e){console.log("$stateChangeStart: "+e.accessLogged),e.accessLogged?(console.log("$stateChangeStart: check if isAuthenticated : "+t.isAuthenticated()),t.isAuthenticated()||(o.preventDefault(),l.$broadcast(n.notAuthenticated))):console.log("$stateChangeStart: PATH free")})}]).controller("LoginController",["$scope","$rootScope","AUTH_EVENTS","AuthService","$state",function(o,e,n,l,t){console.log("LoginController..."),console.log("LoginController...currentUser:"+o.currentUser),o.credentials={username:"",password:""},o.leftButtons=[{type:"button-icon button-clear ion-navicon",tap:function(){$ionicSideMenuDelegate.toggleLeft(o.$$childHead)}}],o.navTitle='<span class="item-calm">Gestione Volontari</span>',o.goto_help=function(){console.log("HelpController : Route to login"),t.go("menu.help")},o.fullscreenOn=function(){console.log("AboutController : fullscreen"),console.log("AboutController : fullscreen enabled? : "+screenfull.enabled),screenfull.request()},o.fullscreenOff=function(){console.log("AboutController : fullscreen"),console.log("AboutController : fullscreen enabled? : "+screenfull.enabled),screenfull.exit()},o.login=function(o){console.log("login:calling .. AuthService. .."),console.log(o),l.login(o).then(function(){e.$broadcast(n.loginSuccess)},function(){e.$broadcast(n.loginFailed)})},o.logout=function(o){console.log("logout:calling .. AuthService. .."),console.log(o),l.logout(o).then(function(){e.$broadcast(n.logoutSuccess)},function(){e.$broadcast(n.logoutSuccess)})}}]).controller("AboutController",["$scope","$rootScope","AUTH_EVENTS","AuthService","Session","$location","$ionicLoading","$http","$ionicPopup",function(o,e,n,l,t,c,s,r,i){console.log("AboutController..."),console.log(t),o.navTitle=t.nome_breve_utenti,o.base_url=e.base_url,o.$location={},angular.forEach("protocol host port path search hash".split(" "),function(e){o.$location[e]=function(){var o=c[e].call(c);return angular.isObject(o)?angular.toJson(o):o}}),o.fullscreenOn=function(){console.log("AboutController : fullscreen"),console.log("AboutController : fullscreen enabled? : "+screenfull.enabled),screenfull.request()},o.fullscreenOff=function(){console.log("AboutController : fullscreen"),console.log("AboutController : fullscreen enabled? : "+screenfull.enabled),screenfull.exit()},o.test_connection=function(){console.log("AboutController : test_connection"),s.show({template:"Loading..."}),r({method:"GET",url:e.base_url+"/mv/testconnection"}).success(function(o,n,l,t){console.log(e.base_url+"/mv/testconnection"),console.log(o),console.log(n),console.log(l),console.log(t);var c=i.alert({title:"OK!",template:"Test di connessione ok"});c.then(function(){console.log("Quit popup")})}).error(function(o,n,l,t){console.log(e.base_url+"/mv/testconnection"),console.log(o),console.log(n),console.log(l),console.log(t);var c=i.alert({title:"Errori!",template:"Test di connessione FALLITO"});c.then(function(){console.log("Quit popup")})}),s.hide()}}]).controller("HelpController",["$scope","$rootScope","AUTH_EVENTS","AuthService","Session","$location","$ionicLoading","$http","$ionicPopup","$ionicSlideBoxDelegate","$state",function(o,e,n,l,t,c,s,r,i,u,a){console.log("HelpController..."),o.goto_login=function(){console.log("HelpController : Route to login"),a.go("menu.login")}}]);
"use strict";angular.module("myApp.controllers").controller("EditItemCtrl",["$scope","$filter","$state","$stateParams","Restangular","rService","Session","$ionicPopup",function(e,t,i,o,n,l,a,r){console.log("EditItemCtrl:  configAction :"+i.current.configAction),console.log(i),console.log(o);var s=i.current.configAction;if(e.configAction=s,e.item={},e.openedPopupDate=!1,console.log("EditItemCtrl:  load button action :"),e.toggleRight=function(){i.go("menu.list")},e.rightButtons=[{type:"button-icon button-clear ion-email",tap:function(){alert("EditItemCtrl : rightButton fired!")}}],"edit"==s||"view"==s||"new"==s){console.log("EditItemCtrl : get data from serviziAll : "+o.id+" ACTION "+s),"new"==s&&(console.log("EditItemCtrl : NEW : set ID === 0"),o.id=0);var c=n.all("serviziAll");c.getList({limit:50,id_servizi_selezione:o.id}).then(function(i){if(e.item=i[0],console.log("EditItemCtrl : load data ...."),console.log("EditItemCtrl : patch time object - 1"),console.log(i[0].da_ora_servizi),console.log(i[0].a_ora_servizi),console.log(i[0].data_servizi),console.log("EditItemCtrl : patch time object - 2 - change format"),e.item.data_servizi=t("date")(i[0].data_servizi,"yyyy-MM-dd"),e.item.a_ora_servizi=i[0].a_ora_servizi.substr(11,5),e.item.da_ora_servizi=i[0].da_ora_servizi.substr(11,5),console.log(e.item.data_servizi),console.log(e.item.a_ora_servizi),console.log(e.item.da_ora_servizi),console.log("EditItemCtrl : elenco_id_volontari"),console.log(i[0].elenco_id_volontari),console.log(i[0].elenco_id_volontari.split(",")),e.item.id_utenti=i[0].id_utenti,e.item.lista_volontari_servizi=i[0].elenco_id_volontari.split(","),e.timeCalculated=l.time_diff(e.item.da_ora_servizi,e.item.a_ora_servizi),e.elenco_id_rapporti_servizio=i[0].elenco_id_rapporti_servizio,e.id_rapporto_valido_servizio=i[0].id_rapporto_valido_servizio,e.item.annullato_servizi=i[0].annullato_servizi,"new"==s&&(console.log("EditItemCtrl : NEW : INIT DATA"),e.item=[],e.item.id_utenti=null,e.item.lista_volontari_servizi=[],e.item.data_servizi=t("date")(new Date,"yyyy-MM-dd"),e.item.a_ora_servizi=t("date")(new Date,"HH:mm"),e.item.da_ora_servizi=t("date")(new Date,"HH:mm"),e.item.annullato_servizi=0),"undefined"!=typeof e.item.id_utenti&&null!=e.item.id_utenti){console.log("EditItemCtrl : populate volontariList per : "+e.item.id_utenti);var o=n.all("volontariAll");o.getList({id_volontari_utenti:e.item.id_utenti}).then(function(t){console.log("EditItemCtrl : patch accounts");var o=[],n=t.length;console.log("EditItemCtrl : patch accounts for "+n);for(var l=0;n>l;l++){var a={id:t[l].id,checked:i[0].elenco_id_volontari.indexOf(t[l].id)>-1?!0:!1,text:t[l].nome_completo_volontari};console.log(a),o.push(a)}console.log(t),e.volontariList=o,console.log(e.volontariList)})}if(a.isAdmin){console.log("EditItemCtrl : populate list : isAdmin "+a.id_utenti+" "+a.nome_breve_utenti);var r=n.all("utentiAll");r.getList().then(function(t){e.utentiList=t;var i=[],o=t.length;console.log("EditItemCtrl : patch accounts for UTENTI LIST FANCY "+o);for(var n=0;o>n;n++){var l={id:t[n].id_utenti,checked:t[n].id_utenti===e.item.id_utenti?!0:!1,text:t[n].nome_breve_utenti};console.log(l),i.push(l)}e.utentiList=i})}else{console.log("EditItemCtrl : populate list : NOT isAdmin "),console.log(a.id_utenti),e.utentiList=[];var c=[],d={id:a.id_utenti,checked:!0,text:a.nome_breve_utenti};c.push(d),e.utentiList=c,e.item.id_utenti=a.id_utenti,e.item.nome_breve_utenti=a.nome_breve_utenti}})}e.master={},e.timeCalculated=0,e.timechanged=function(){console.log("EditItemCtrl : Time changed to: "+e.item.da_ora_servizi),console.log("EditItemCtrl : Time changed to: "+e.item.a_ora_servizi),e.timeCalculated=l.time_diff(e.item.da_ora_servizi,e.item.a_ora_servizi),e.timeCalculated<1&&(e.timeCalculated=e.timeCalculated+24)},e.cancel_action=function(e){console.log("EditItemCtrl : cancel_action....");var t=r.confirm({title:"Messaggio",template:"Annullare il presente elemento?"});t.then(function(t){t?(console.log("EditItemCtrl : Deleting...."),console.log(e.id_servizi),n.oneUrl("servizi","/api1/servizi/"+e.id).get().then(function(t){console.log("get!"),console.log(t),t.annullato_servizi=1,console.log("put!"),n.setBaseUrl("/api1"),t.customPUT({annullato_servizi:1},e.id,{},{}),n.setBaseUrl("/apiQ"),i.go("menu.list")})):console.log("EditItemCtrl : Canceled....")})},e.save_action=function(){console.log("EditItemCtrl:save_action:Start validator : ");var t="";if("undefined"==typeof e.item.elenco_id_volontari&&(t="Selezionare un volontario!"),""==e.item.elenco_id_volontari&&(t="Selezionare un volontario!"),console.log("EditItemCtrl:save_action:Start validator :data_servizi :"+e.item.data_servizi),console.log("EditItemCtrl:save_action:Start validator :data_servizi :"+new Date),!a.isAdmin&&e.item.data_servizi<new Date&&(t="Non Ã¨ possibile selezionare date del servizio precedenti a quelle odierna."),""!=t){console.log("validate KO");var o=r.alert({title:"Errori di input",template:t});o.then(function(){console.log("Thank you for not eating my delicious ice cream cone")})}else{console.log("validate OK ... saving data ...");var l={id_utenti:e.item.id_utenti,data_servizi:e.item.data_servizi,da_ora_servizi:"1900-01-01T"+e.item.da_ora_servizi+":00.000Z",a_ora_servizi:"1900-01-01T"+e.item.a_ora_servizi+":00.000Z",note_servizi:e.item.note_servizi,lista_volontari:e.item.elenco_id_volontari.split(","),rapporto_servizi:e.item.rapporto_servizi};console.log("Posting ... "),console.log(l);var s=n.allUrl("servizi","/api1/servizi");s.post(l).then(function(e){console.log("Object saved OK"),console.log(e.id),console.log("Saving detail....data ");var t=r.alert({title:"Messaggio",template:"Dato inserito con successo!"});t.then(function(){console.log("ok redirect to id: "+e.id),i.go("menu.edit",{id:e.id})})},function(e){console.log("There was an error saving ... "),console.log(e)})}},e.new_relazione_action=function(e){console.log("Route to newRelazioni con id : "+e),i.go("menu.newRelazioni",{id:e})},e.goto_relazione_action=function(e){console.log("Route to editRelazioni con id : "+e),i.go("menu.editRelazioni",{id:e})},e.popupDate=function(t){console.log("EditItemCtrl : popupDate"),t.preventDefault(),t.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.debug_action=function(e){console.log("DEBUG_ACTION"),console.log(e)},console.log("EditItemCtrl : watching item.id_utenti"),e.$watch("item.id_utenti",function(t,i){if(console.log("EditItemCtrl : WATCH! id_utenti changed!"+t+" "+i),"new"==s&&"undefined"!=typeof t&&null!=t){var o=n.all("volontariAll");o.getList({id_volontari_utenti:t}).then(function(i){console.log("EditItemCtrl : WATCH! get list for value "+t);var o=[],n=i.length;console.log("EditItemCtrl : WATCH! patch accounts for "+n);for(var l=0;n>l;l++){var a={id:i[l].id,checked:!1,text:i[l].nome_completo_volontari};console.log(a),o.push(a)}console.log(i),e.item.elenco_volontari="",e.item.elenco_id_volontari="",e.volontariList=o,console.log(e.volontariList)})}}),e.$watch("item.volontariList1",function(e,t){console.log("EditItemCtrl : DA_item.lista_volontari_servizi"+e+" "+t)})}]).controller("InfiniteCtrl",["$scope","$location","Restangular","$filter","Session","$ionicModal","$ionicSideMenuDelegate","$ionicPopover","$ionicLoading",function(e,t,i,o,n,l,a,r,s){console.log("SERVIZI>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),console.log("InfiniteCtrl start..."),e.totalPages=0,e.itemsCount=0,e.currentPage=1,e.currentItemDetail=null,e.totalItems=0,e.pageSize=1e3,e.startPage=0,e.openedPopupDate=!1,e.utentiList=[],e.id_utenti_selezione=0,e.items=[],e.loadMoreDataCanBeLoaded=!0,l.fromTemplateUrl("partials/sortModal.html",function(t){e.sortModal=t},{scope:e,animation:"slide-in-up"}),l.fromTemplateUrl("partials/detailModal.html",function(t){e.detailModal=t},{scope:e,animation:"slide-in-up"}),e.openSortModal=function(){console.log("InfiniteCtrl Sort Modal ..."),e.sortModal.show()},e.openDetailModal=function(t){console.log("InfiniteCtrl Detail Modal ... :"),console.log(t),t.data_servizi=o("date")(t.data_servizi,"dd/MM/yyyy"),t.a_ora_servizi=t.a_ora_servizi.substr(11,5),t.da_ora_servizi=t.da_ora_servizi.substr(11,5),e.currentItemDetail=t,e.detailModal.show()},e.closeSortModal=function(){e.sortModal.hide()},e.closeDetailModal=function(){e.detailModal.hide()},e.saveSort=function(){console.log("SORT MODAL "+this.filterTerm+" sort "+this.sortBy+" id_selezione :"+this.id_utenti_selezione),e.filterCriteria.id_utenti_selezione=this.id_utenti_selezione,console.log(e.filterCriteria),e.filterTerm=this.filterTerm,e.sortBy=this.sortBy,e.sortModal.hide(),e.fetchResult()},e.OpenFilter=function(){console.log("OpenFilter .. sortModal.show()"),e.sortModal.show()},e.filterCriteria={pageNumber:1,count:0,limit:e.pageSize,start:0,sortDir:"asc",sortedBy:"id",id_utenti_selezione:n.isAdmin?0:n.id_utenti,mese_selezione:0,anno_selezione:0},console.log("InfiniteCtrl SERVIZI INIT filterCriteria"),console.log(e.filterCriteria);var c=i.all("utentiAll");console.log("InfiniteCtrl #VolontariListURL "+c.getRestangularUrl()),c.getList().then(function(t){console.log(t),n.isAdmin?(console.log("InfiniteCtrl : populate list : isAdmin "),e.utentiList=t,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"}),e.id_utenti_selezione=0):(console.log("InfiniteCtrl : populate list : NOT isAdmin "),console.log(n.id_utenti),e.id_utenti_selezione=n.id_utenti,e.filterCriteria.id_utenti_selezione=n.id_utenti,e.utentiList=[],e.utentiList.push({id_utenti:n.id_utenti,nome_breve_utenti:n.nome_breve_utenti}))}),e.fetchResult=function(){console.log("InfiniteCtrl: fetchResult"),console.log("InfiniteCtrl: impostazione criteri di filtro");var t=(e.currentPage-1)*e.pageSize;e.filterCriteria.start=t,console.log(e.filterCriteria);var o=i.all("serviziAll");return console.log("InfiniteCtrl...fetchResult - GET Count"),console.log("InfiniteCtrl...fetchResult - GET data"),e.filterCriteria.count=0,s.show({template:"Dati in arrivo!"}),o.getList(e.filterCriteria).then(function(t){e.items=t,console.log(" .. data loaded!"),s.hide()},function(){e.items=[]})},e.selectPage=function(){var t=e.currentPage;console.log("SELECT PAGE ..."),console.log("Page changed to: "+e.currentPage),console.log("InfiniteCtrl...selectPage:"+t),e.currentPage=t,e.filterCriteria.pageNumber=t,e.fetchResult()},console.log("InfiniteCtrl : selectPage 1"),e.selectPage(),e.editItem=function(e){console.log("editItem : change state"),console.log(e),t.path("/menu/edit/"+e)},e.editItem=function(e){console.log("viewItem : change state"),console.log(e),t.path("/menu/view/"+e)},e.editRelazioni=function(e){console.log("/menu/editItem"),t.path("/menu/editRelazioni/"+e)},e.newRelazioni=function(){console.log("/menu/new"),t.path("/menu/new")},e.debug_action=function(){console.log("DEBUG_ACTION"),console.log(e)},e.newRelazioniFromPopover=function(){console.log("/menu/new"),e.popover.remove(),t.path("/menu/new")},e.OpenFilterFromPopover=function(){console.log("OpenFilterFromPopover"),e.popover.hide(),e.sortModal.show()};var d="<ion-popover-view>";d+="<ion-content>",d+='<div class="list">',d+='<a class="item item-icon-left" ng-click="newRelazioniFromPopover()" ><i class="icon ion-plus-circled"></i> Nuovo elemento</a>',d+='<a class="item item-icon-left" ng-click="OpenFilterFromPopover()"><i class="icon ion-funnel"></i>Filtro</a>',d+="</div>",d+="</ion-content>",d+="</ion-popover-view>",console.log(d),e.popover=r.fromTemplate(d,{scope:e}),e.$on("$destroy",function(){e.popover.remove()})}]);
"use strict";angular.module("myApp.controllers").controller("EditItemCtrlRelazioni",["$scope","$filter","$state","$stateParams","Restangular","rService","Session","$ionicPopup",function(e,i,t,o,n,l,a,r){console.log("EditItemCtrlRelazioni:  configAction :"+t.current.configAction),console.log(t),console.log(o);var c=t.current.configAction;if(e.configAction=c,e.item={},e.openedPopupDate=!1,console.log("EditItemCtrlRelazioni : get data from rapportiAll : "+o.id+" Action "+c),"edit"==c||"view"==c)var s=n.all("rapportiAll"),_={limit:50,id_rapporti_selezione:o.id};else var s=n.all("serviziAll"),_={limit:50,id_servizi_selezione:o.id};s.getList(_).then(function(t){if(console.log(t),"edit"==c||"view"==c?(console.log("EditItemCtrlRelazioni : load data for ...."+c),e.item.id=o.id,e.item.id_servizi=t[0].id_servizi,e.item.id_utenti=t[0].id_utenti,e.item.nome_breve_utenti=t[0].nome_breve_utenti,e.item.elenco_id_volontari=t[0].elenco_id_volontari,e.item.elenco_volontari=t[0].elenco_volontari,e.item.lista_volontari_relazioni=t[0].elenco_id_volontari.split(","),e.item.data_relazioni=i("date")(t[0].data_relazioni,"yyyy-MM-dd"),e.item.a_ora_relazioni=i("date")(t[0].a_ora_relazioni,"HH:mm"),e.item.da_ora_relazioni=i("date")(t[0].da_ora_relazioni,"HH:mm"),e.timeCalculated=l.time_diff(e.item.da_ora_relazioni,e.item.a_ora_relazioni),e.item.auto_relazioni=t[0].auto_relazioni,e.item.note_relazioni=t[0].note_relazioni,e.item.rapporto_relazioni=t[0].rapporto_relazioni,e.item.annullato_relazioni=t[0].annullato_relazioni):(console.log("EditItemCtrlRelazioni : load data for ...."+c),e.item.id_servizi=o.id,e.item.id_utenti=t[0].id_utenti,e.item.nome_breve_utenti=t[0].nome_breve_utenti,e.item.elenco_id_volontari=t[0].elenco_id_volontari,e.item.elenco_volontari=t[0].elenco_volontari,e.item.lista_volontari_relazioni=t[0].elenco_id_volontari.split(","),e.item.elenco_id_volontari=t[0].elenco_id_volontari,e.item.data_relazioni=i("date")(t[0].data_servizi,"yyyy-MM-dd"),e.item.a_ora_relazioni=i("date")(t[0].a_ora_servizi,"HH:mm"),e.item.da_ora_relazioni=i("date")(t[0].da_ora_servizi,"HH:mm"),e.timeCalculated=l.time_diff(e.item.da_ora_relazioni,e.item.a_ora_relazioni),e.item.auto_relazioni=" -- NEW AUTO --",e.item.note_relazioni=" -- NEW NOTE --",e.item.rapporto_relazioni=" -- NEW RAPPORTO --",e.item.annullato_relazioni=0),"undefined"!=typeof e.item.id_utenti&&null!=e.item.id_utenti){console.log("EditItemCtrlRelazioni : fill volontariList per : "+e.item.id_utenti);var r=n.all("volontariAll");r.getList({id_volontari_utenti:e.item.id_utenti}).then(function(i){var o=[],n=i.length;console.log("EditItemCtrlRelazioni : patch accounts for n. "+n);for(var l=0;n>l;l++){var a={id:i[l].id,checked:t[0].elenco_id_volontari.indexOf(i[l].id)>-1?!0:!1,text:i[l].nome_completo_volontari};o.push(a)}e.volontariList=o,console.log(e.volontariList)})}if(a.isAdmin){console.log("EditItemCtrlRelazioni : populate list : isAdmin "+a.id_utenti+" "+a.nome_breve_utenti);var s=n.all("utentiAll");s.getList().then(function(i){e.utentiList=i;var t=[],o=i.length;console.log("EditItemCtrlRelazioni : patch accounts for UTENTI LIST FANCY "+o);for(var n=0;o>n;n++){var l={id:i[n].id_utenti,checked:i[n].id_utenti===e.item.id_utenti?!0:!1,text:i[n].nome_breve_utenti};console.log(l),t.push(l)}e.utentiList=t})}else{console.log("EditItemCtrlRelazioni : populate list : NOT isAdmin "),console.log(a.id_utenti),e.utentiList=[];var _=[],d={id:a.id_utenti,checked:!0,text:a.nome_breve_utenti};_.push(d),e.utentiList=_,e.item.id_utenti=a.id_utenti,e.item.nome_breve_utenti=a.nome_breve_utenti}}),e.toggleRight=function(){t.go("menu.listRelazioni")},e.master={},e.timeCalculated=0,e.timechanged=function(){console.log("EditItemCtrlRelazioni : Time changed to: "+e.item.da_ora_relazioni),console.log("EditItemCtrlRelazioni : Time changed to: "+e.item.a_ora_relazioni),e.timeCalculated=l.time_diff(e.item.da_ora_relazioni,e.item.a_ora_relazioni),e.timeCalculated<1&&(e.timeCalculated=e.timeCalculated+24)},e.cancel_action=function(e){console.log("EditItemCtrl : cancel_action....");var i=r.confirm({title:"Messaggio",template:"Annullare il presente elemento?"});i.then(function(i){i?(console.log("EditItemCtrlRelazioni : Deleting...."),console.log(e.id),n.oneUrl("relazioni","/api1/relazioni/"+e.id).get().then(function(i){console.log("get!"),console.log(i),i.annullato_relazioni=1,console.log("put!"),n.setBaseUrl("/api1"),i.customPUT({annullato_relazioni:1},e.id,{},{}),n.setBaseUrl("/apiQ"),t.go("menu.listRelazioni")}),console.log("EditItemCtrlRelazioni : ANNULLATO "+e.id)):console.log("EditItemCtrl : Canceled....")})},e.save_action=function(){console.log("EditItemCtrlRelazioni:save_action:Start validator : ");var i="";if("undefined"==typeof e.item.elenco_id_volontari&&(i="Selezionare un volontario!"),""==e.item.elenco_id_volontari&&(i="Selezionare un volontario!"),0==e.item.lista_volontari_relazioni.length&&(i="Selezionare un volontario!"),""!=i){console.log("validate KO");var o=r.alert({title:"Errori di input",template:i});o.then(function(){console.log("Thank you for not eating my delicious ice cream cone")})}else{console.log("validate OK ... saving data ...");var l={id_utenti:e.item.id_utenti,id_servizi:e.item.id_servizi,data_relazioni:e.item.data_relazioni,da_ora_relazioni:"1900-01-01T"+e.item.da_ora_relazioni+":00.000Z",a_ora_relazioni:"1900-01-01T"+e.item.a_ora_relazioni+":00.000Z",note_relazioni:e.item.note_relazioni,auto_relazioni:e.item.auto_relazioni,rapporto_relazioni:e.item.rapporto_relazioni,lista_volontari:e.item.lista_volontari_relazioni};console.log("POST ... "),console.log(l),console.log(l);var a=n.allUrl("relazioni","/api1/relazioni");a.post(l).then(function(e){console.log("Object saved OK"),console.log(e.id);var i=r.alert({title:"Messaggio",template:"Dato inserito con successo!"});i.then(function(){console.log("ok redirect to id: "+e.id),t.go("menu.viewRelazioni",{id:e.id})})},function(e){console.log("There was an error saving ... "),console.log(e)})}},e.popupDate=function(i){console.log("EditItemCtrlRelazioni : popupDate"),i.preventDefault(),i.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.debug_action=function(e){console.log("DEBUG_ACTION"),console.log(e)},console.log("EditItemCtrlRelazioni : watching item.id_utenti"),e.$watch("item.id_utenti",function(e,i){console.log("EditItemCtrlRelazioni : id_utenti changed!"+e+" "+i+" NO ACTION ")})}]).controller("InfiniteCtrlRelazioni",["$scope","$location","Restangular","$filter","Session","$ionicPopup","$ionicPopover",function(e,i,t,o,n,l,a){console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),console.log("InfiniteCtrlRelazioni START!"),e.totalPages=0,e.itemsCount=0,e.currentPage=1,e.totalItems=0,e.pageSize=8,e.startPage=0,e.openedPopupDate=!1,e.utentiList=[],e.filterCriteria={pageNumber:1,count:0,limit:e.pageSize,start:0,sortDir:"asc",sortedBy:"id",id_utenti_selezione:n.isAdmin?0:n.id_utenti,mese_selezione:0,anno_selezione:0},console.log("InfiniteCtrlRapporti INIT filterCriteria:"),console.log(e.filterCriteria);var r=t.all("utentiAll");r.getList().then(function(i){console.log(i),n.isAdmin?(console.log("InfiniteCtrlRapporti : populate list : isAdmin "),e.utentiList=i,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"}),e.id_utenti_selezione=0):(console.log("InfiniteCtrlRapporti : populate list : NOT isAdmin "),console.log(n.id_utenti),e.id_utenti_selezione=n.id_utenti,e.filterCriteria.id_utenti_selezione=n.id_utenti,e.utentiList=[],e.utentiList.push({id_utenti:n.id_utenti,nome_breve_utenti:n.nome_breve_utenti}))}),e.fetchResult=function(){console.log("InfiniteCtrlRapporti...fetchResult"),console.log(e.filterCriteria);var i=t.all("rapportiAll");console.log("InfiniteCtrlRapporti...fetchResult - count"),e.filterCriteria.count=1,i.getList(e.filterCriteria).then(function(i){console.log("COUNT: data[0].totalItems:"+i[0].totalItems),console.log(i),e.totalItems=i.length>0?i[0].totalItems:0},function(){e.totalItems=0}),console.log("InfiniteCtrlRapporti...fetchResult - get data");var o=(e.currentPage-1)*e.pageSize;return e.filterCriteria.count=0,e.filterCriteria.start=o,i.getList(e.filterCriteria).then(function(i){console.log(i),e.items=i},function(){e.items=[]})},e.selectPage=function(){var i=e.currentPage;console.log("Page changed to: "+e.currentPage),console.log("InfiniteCtrl...selectPage:"+i),e.currentPage=i,e.filterCriteria.pageNumber=i,e.fetchResult()},console.log("InfiniteCtrl : selectPage 1"),e.selectPage(1),e.popupDate=function(i){console.log("popupDate"),i.preventDefault(),i.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.editItem=function(e){console.log("editItem"),i.path("/menu/editRelazioni/"+e)},e.viewItem=function(e){console.log("viewItem"),i.path("/menu/viewRelazioni/"+e)},e.toggleRight=function(){var e=l.alert({title:"*TODO*",template:"TODO"});e.then(function(){console.log("EditItemCtrlRelazioni: toggleRight")})},e.OpenFilterFromPopover=function(){e.popover.hide()};var c="<ion-popover-view>";c+="<ion-content>",c+='<div class="list">',c+='<a class="item item-icon-left" ng-click="OpenFilterFromPopover()"><i class="icon ion-funnel"></i>Filtro</a>',c+="</div>",c+="</ion-content>",c+="</ion-popover-view>",console.log(c),e.popover=a.fromTemplate(c,{scope:e}),e.$on("$destroy",function(){e.popover.remove()})}]);
"use strict";angular.module("myApp.controllers").controller("ReportCtrlMobile",["$scope","$rootScope","Restangular","rService","$filter","$http","$sce","Session","$ionicPopup",function(e,t,o,i,n,l,r,a,s){if(e.timeCalculated=0,e.item={},e.item.tipo_report=1,e.openedPopupDate=!1,e.showDownloadButton=!1,e.showDownloadUrl=!1,e.showGoogleViewUrl="",a.isAdmin){console.log("EditItemCtrl : populate list : isAdmin ");var u=o.all("utentiAll");u.getList().then(function(t){e.utentiList=t,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"})})}else console.log("EditItemCtrl : populate list : NOT isAdmin "),console.log(a.id_utenti),e.utentiList=[],e.utentiList.push({id_utenti:a.id_utenti,nome_breve_utenti:a.nome_breve_utenti}),e.item.id_utenti=a.id_utenti;e.popupDate=function(t){console.log("popupDate"),t.preventDefault(),t.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.view_pdf=function(){console.log("ReportCtrlMobile: view pdf open window..."),console.log(t.base_url+e.showDownloadUrl);window.open(e.showGoogleViewUrl,"_blank","location=no")},e.build_report=function(i){console.log("ReportCtrlMobile: build_report..."),console.log(i),console.log("ReportCtrlMobile:build report:Start validator : ");var l="";if(l=e.item.id_utenti>=0?"":"Selezionare una Associazione",e.item.data_servizi||(l="Selezionare una data!"),""!=l){console.log("validate KO");var r=s.alert({title:"Errori di input",template:l});r.then(function(){console.log("XXThank you for not eating my delicious ice cream cone")})}else{var a={id_utenti:e.item.id_utenti,tipo_report:e.item.tipo_report,data_servizi:e.item.data_servizi,relazione_servizio:e.item.relazione_servizio,utenti_controllati:e.item.utenti_controllati,dati_auto:e.item.dati_auto,giorno_servizi:n("date")(e.item.data_servizi,"dd"),mese_servizi:n("date")(e.item.data_servizi,"MM"),anno_servizi:n("date")(e.item.data_servizi,"yyyy"),nome_file:(new Date).getTime(),mobile:1},u=o.allUrl("pdf","/pdf");u.getList(a).then(function(o){if(console.log(o),"NODATATODISPLAY"==o[0].report_filename){var i=s.alert({title:"Messaggio",template:"Nessun dato da visualizzare"});i.then(function(){console.log("XXThank you for not eating my delicious ice cream cone")})}else e.showDownloadButton=!0,e.showDownloadButtonText="Scarica la stampa pdf ("+o[0].report_filename+")",e.showDownloadUrl="/pdfget?nomefile="+o[0].report_filename,e.showGoogleViewUrl="https://docs.google.com/viewer?url="+encodeURIComponent(t.base_url+e.showDownloadUrl);console.log(e.showDownloadUrl)},function(){console.log("ERRORE")})}}}]).controller("TestController",["$scope","Session","Restangular","$rootScope","$modal","$filter","$location",function(e,t,o,i,n,l,r){console.log("TestController... START!"),e.totalPages=0,e.itemsCount=0,e.currentPage=1,e.totalItems=0,e.pageSize=3,e.startPage=0,e.openedPopupDate=!1,e.utentiList=[],e.filterCriteria={pageNumber:1,count:0,limit:e.pageSize,start:0,sortDir:"asc",sortedBy:"id",id_utenti_selezione:0,mese_selezione:0,anno_selezione:0};var a=o.all("utentiAll");a.getList().then(function(o){console.log(o),t.isAdmin?(console.log("TestController : populate list : isAdmin "),e.utentiList=o,e.utentiList.push({id_utenti:0,nome_breve_utenti:"TUTTI"}),e.id_utenti_selezione=0):(console.log("TestController : populate list : NOT isAdmin "),console.log(t.id_utenti),e.id_utenti_selezione=t.id_utenti,e.utentiList=[],e.utentiList.push({id_utenti:t.id_utenti,nome_breve_utenti:t.nome_breve_utenti}))}),e.fetchResult=function(){console.log("TestController...fetchResult"),console.log(e.filterCriteria);var t=o.all("serviziAll");console.log("TestController...fetchResult - count"),e.filterCriteria.count=1,t.getList(e.filterCriteria).then(function(t){console.log("COUNT: data[0].totalItems:"),console.log(t),e.totalItems=t.length>0?t[0].totalItems:0},function(){e.totalItems=0}),console.log("TestController...fetchResult - get data");var i=(e.currentPage-1)*e.pageSize;return e.filterCriteria.count=0,e.filterCriteria.start=i,t.getList(e.filterCriteria).then(function(t){console.log(t),e.items=t},function(){e.items=[]})},e.selectPage=function(){var t=e.currentPage;console.log("Page changed to: "+e.currentPage),console.log("TestController...selectPage:"+t),e.currentPage=t,e.filterCriteria.pageNumber=t,e.fetchResult()},e.selectPage(1),e.$watch("id_utenti_selezione",function(o,i){console.log("id_utenti changed! New "+o+" Old "+i),t.isAdmin?(e.filterCriteria.id_utenti_selezione=o,e.currentPage=1,e.filterCriteria.pageNumber=e.currentPage,e.fetchResult()):console.log("id_utenti changed! New NO ADMIN NO ACTION")}),e.$watch("data_servizi_selezione",function(t,o){console.log("data_servizi changed!"+t+" "+o),t?(console.log(l("date")(t,"MM")),console.log(l("date")(t,"yyyy")),e.filterCriteria.mese_selezione=l("date")(t,"MM"),e.filterCriteria.anno_selezione=l("date")(t,"yyyy")):(e.filterCriteria.mese_selezione=0,e.filterCriteria.anno_selezione=0),e.currentPage=1,e.filterCriteria.pageNumber=e.currentPage,e.fetchResult()}),e.popupDate=function(t){console.log("popupDate"),t.preventDefault(),t.stopPropagation(),e.openedPopupDate=e.openedPopupDate?!1:!0},e.editItem=function(e){console.log("editItem"),r.path("/edit/"+e)},e.viewItem=function(e){console.log("viewItem"),r.path("/view/"+e)},e.items=["item1","item2","item3"];var s=function(e,t,o){e.items=o,e.selected={item:e.items[0]},e.ok=function(){t.close(e.selected.item)},e.cancel=function(){t.dismiss("cancel")}};e.open=function(t){var o=n.open({templateUrl:"myModalContent.html",controller:s,size:t,resolve:{items:function(){return e.items}}});o.result.then(function(t){e.selected=t},function(){console.log("Modal dismissed at: "+new Date)})}}]);
"use strict";angular.module("myApp.filters",[]).filter("interpolate",["version",function(e){return function(t){return String(t).replace(/\%VERSION\%/gm,e)}}]).filter("asDate",function(){return function(e){return console.log("FILTER:asDate:"+e),new Date(e)}}).filter("datetmUTC",function(e){return function(t){if(null==t)return"";console.log("FILTER:datetmUTC:"+t);var n=e("date")(new Date(t),"MMM dd yyyy - HH:mm:ss");console.log("FILTER:datetmUTC:"+n);var r=new Date(n);return console.log("FILTER:datetmUTC:"+r),console.log("FILTER:datetmUTC:"+r.getTime()),r.getTime()}});
"use strict";angular.module("myApp.directives",[]).directive("appVersion",["version",function(e){return function(t,i){i.text(e)}}]).directive("browserVersion",["version",function(){return function(){var e=navigator.userAgent;this.IsIE=!1,this.IsOn=void 0,this.Version=void 0,e.indexOf("MSIE 7.0")>-1&&(this.IsIE=!0,this.IsOn=!0,e.indexOf("Trident/6.0")>-1?this.Version="IE10":e.indexOf("Trident/5.0")>-1?this.Version="IE9":e.indexOf("Trident/4.0")>-1?this.Version="IE8":(this.IsOn=!1,this.Version="IE7"))}}]).directive("fancySelect",["$ionicModal",function(e){return{restrict:"E",templateUrl:"partials/fancy-select.html",scope:{items:"=",text:"=",value:"=",callback:"&"},link:function(t,i,n){t.multiSelect="true"===n.multiSelect?!0:!1,t.allowEmpty="false"===n.allowEmpty?!1:!0,t.headerText=n.headerText||"",t.labelText=n.labelText||"",t.defaultText=t.text||"",t.noteText=n.noteText||"",t.noteImg=n.noteImg||"",t.noteImgClass=n.noteImgClass||"",e.fromTemplateUrl("partials/fancy-select-items.html",{scope:t}).then(function(e){t.modal=e}),t.validate=function(){1==t.multiSelect&&(t.value="",t.text="",jQuery.each(t.items,function(e,i){i.checked&&(t.value=t.value+i.id+",",t.text=t.text+"\r"+i.text+", ")}),t.value=t.value.substr(0,t.value.length-1),t.text=t.text.substr(0,t.text.length-2),console.log("#DIRECTIVE#Fancy#value:"+t.value),console.log("#DIRECTIVE#Fancy#text:"+t.text)),("undefined"==typeof t.value||""==t.value||null==t.value)&&(0==t.allowEmpty?(t.value=t.items[0].id,t.text=t.items[0].text,t.items[0].checked=!0):t.text=t.defaultText),t.hideItems(),"function"==typeof t.callback&&t.callback(t.value)},t.showItems=function(e){e.preventDefault(),t.modal.show()},t.hideItems=function(){t.modal.hide()},t.$on("$destroy",function(){t.modal.remove()}),t.validateSingle=function(e){t.text=e.text,t.value=e.id,t.hideItems(),"function"==typeof t.callback&&t.callback(t.value)}}}}]);